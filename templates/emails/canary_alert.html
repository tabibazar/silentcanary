{% extends "emails/base.html" %}

{% block title %}{% if smart_alert_enabled %}ðŸ§  SilentCanary Smart Alert - {{ canary_name }}{% else %}ðŸš¨ SilentCanary Alert - {{ canary_name }}{% endif %}{% endblock %}

{% block content %}
{% if smart_alert_enabled %}
<h2 style="color: #ffc107;">ðŸ§  SilentCanary Smart Alert</h2>

<div class="alert alert-warning">
    <strong>Smart Alert:</strong> Our machine learning system detected an anomaly in your canary <strong>{{ canary_name }}</strong> check-in patterns!
</div>
{% else %}
<h2 style="color: #dc3545;">ðŸš¨ Canary Alert</h2>

<div class="alert alert-danger">
    <strong>Alert:</strong> Your canary <strong>{{ canary_name }}</strong> has missed its check-in!
</div>
{% endif %}

<p><strong>Canary Details:</strong></p>
<ul>
    <li><strong>Name:</strong> {{ canary_name }}</li>
    <li><strong>Environment:</strong> {{ environment or 'Not specified' }}</li>
    <li><strong>Service:</strong> {{ service_name or 'Not specified' }}</li>
    <li><strong>Expected Check-in:</strong> Every {{ interval_minutes }} minutes</li>
    <li><strong>Last Check-in:</strong> {{ last_checkin or 'Never' }}</li>
    <li><strong>Status:</strong> <span style="color: #dc3545; font-weight: bold;">{{ status }}</span></li>
</ul>

{% if smart_alert_enabled %}
<div class="alert alert-info">
    <strong>ðŸ§  Smart Alert Details:</strong><br>
    This alert was triggered by machine learning analysis of your check-in patterns, indicating behavior that deviates from your normal schedule.
    
    {% if avg_interval or expected_interval or sensitivity or learning_period_days %}
    <ul style="margin-top: 10px;">
        {% if avg_interval %}
        <li><strong>Expected average interval:</strong> {{ avg_interval }} minutes</li>
        {% endif %}
        {% if expected_interval %}
        <li><strong>Configured interval:</strong> {{ expected_interval }} minutes</li>
        {% endif %}
        {% if sensitivity %}
        <li><strong>Sensitivity:</strong> {{ sensitivity }}%</li>
        {% endif %}
        {% if learning_period_days %}
        <li><strong>Analysis period:</strong> {{ learning_period_days }} days</li>
        {% endif %}
    </ul>
    {% endif %}
</div>
{% endif %}

<p><strong>Recommended Actions:</strong></p>
<ul>
    {% if smart_alert_enabled %}
    <li>Check if your process is running normally</li>
    <li>Verify if this timing change is expected</li>
    <li>If this is normal behavior, you can adjust sensitivity in Smart Alert settings</li>
    <li>Consider if external factors might be affecting your schedule</li>
    {% else %}
    <li>Check your deployment status and logs</li>
    <li>Verify your application is running properly</li>
    <li>Review recent deployments for issues</li>
    {% endif %}
    {% if dashboard_link %}
    <li>Visit your <a href="{{ dashboard_link }}">dashboard</a> for more details</li>
    {% endif %}
</ul>

<p style="text-align: center;">
    {% if dashboard_link %}
    <a href="{{ dashboard_link }}" class="btn btn-danger">View Dashboard</a>
    {% endif %}
    {% if canary_logs_link %}
    <a href="{{ canary_logs_link }}" class="btn">View Logs</a>
    {% endif %}
    {% if smart_alert_link %}
    <a href="{{ smart_alert_link }}" class="btn">Configure Smart Alerts</a>
    {% endif %}
</p>

<div class="alert alert-warning">
    <strong>Need help?</strong><br>
    If this alert seems incorrect or you need assistance, please <a href="https://silentcanary.com/contact">contact our support team</a>.
</div>

{% if smart_alert_enabled %}
<div class="alert alert-light" style="margin-top: 20px;">
    <small><em>This is a smart alert - meaning it was triggered by pattern analysis, not just a simple timeout. Learn more at <a href="https://silentcanary.com">SilentCanary.com</a></em></small>
</div>
{% endif %}

<p>Best regards,<br>The SilentCanary Monitoring Team</p>
{% endblock %}