{% extends "base.html" %}

{% block title %}Contact Us - SilentCanary{% endblock %}

{% block extra_css %}
<style>
    .contact-hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        position: relative;
        overflow: hidden;
    }
    
    .contact-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
    }
    
    .contact-hero-content {
        position: relative;
        z-index: 1;
    }
    
    .contact-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }
    
    .contact-card:hover {
        transform: translateY(-5px);
    }
    
    .contact-method {
        text-align: center;
        padding: 2rem;
        border-radius: 15px;
        background: #f8f9fa;
        transition: all 0.3s ease;
        height: 100%;
    }
    
    .contact-method:hover {
        background: #e9ecef;
        transform: translateY(-3px);
    }
    
    .contact-method i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: #007bff;
    }
    
    .form-floating {
        position: relative;
    }
    
    .form-floating label {
        color: #6c757d;
    }
    
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 10px;
        padding: 12px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
    }
    
    .faq-item {
        border: none;
        border-radius: 10px;
        margin-bottom: 1rem;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .faq-header {
        background: #f8f9fa;
        border: none;
        padding: 1.5rem;
        font-weight: 600;
        color: #495057;
        text-align: left;
        width: 100%;
        transition: background-color 0.3s ease;
    }
    
    .faq-header:hover {
        background: #e9ecef;
    }
    
    .faq-header:focus {
        box-shadow: none;
    }
    
    .faq-body {
        padding: 1.5rem;
        background: white;
    }
</style>
{% endblock %}

{% block content %}
<!-- Contact Hero -->
<div class="contact-hero p-5 mb-5">
    <div class="contact-hero-content text-center">
        <h1 class="display-4 mb-3">
            <i class="fas fa-envelope"></i> Get in Touch
        </h1>
        <p class="lead mb-4">We're here to help with any questions about SilentCanary</p>
        <p class="mb-0">Whether you need technical support, have a billing question, or want to discuss enterprise solutions, our team is ready to assist.</p>
    </div>
</div>

<div class="row">
    <!-- Contact Form -->
    <div class="col-lg-8 mb-5">
        <div class="card contact-card">
            <div class="card-body p-5">
                <h3 class="mb-4">
                    <i class="fas fa-paper-plane text-primary me-2"></i>Send us a Message
                </h3>
                
                <form method="POST" id="contactForm">
                    {{ form.hidden_tag() }}
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="form-floating">
                                {{ form.name(class="form-control", placeholder="Your Name") }}
                                {{ form.name.label() }}
                                {% if form.name.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.name.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="form-floating">
                                {{ form.email(class="form-control", placeholder="your@email.com") }}
                                {{ form.email.label() }}
                                {% if form.email.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.email.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="form-floating">
                            {{ form.subject(class="form-control", placeholder="Subject") }}
                            {{ form.subject.label() }}
                            {% if form.subject.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.subject.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="{{ form.category.id }}" class="form-label">Category</label>
                        {{ form.category(class="form-select") }}
                        {% if form.category.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.category.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-4">
                        <div class="form-floating">
                            {{ form.message(class="form-control", placeholder="Your message...", style="height: 150px") }}
                            {{ form.message.label() }}
                            {% if form.message.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.message.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        {{ form.submit(class="btn btn-primary btn-lg") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Contact Information -->
    <div class="col-lg-4">
        <!-- Quick Contact -->
        <div class="mb-4">
            <div class="contact-method">
                <i class="fas fa-headset"></i>
                <h5>Quick Support</h5>
                <p class="text-muted">Need immediate help? Check our documentation first for instant answers.</p>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('help_overview') }}" class="btn btn-outline-primary">
                    <i class="fas fa-book me-1"></i> Browse Docs
                </a>
                {% else %}
                <a href="{{ url_for('register') }}" class="btn btn-outline-primary">
                    <i class="fas fa-rocket me-1"></i> Get Started
                </a>
                {% endif %}
            </div>
        </div>
        
        <!-- Response Time -->
        <div class="alert alert-info">
            <i class="fas fa-clock me-2"></i>
            <strong>Response Times:</strong><br>
            <small>
                • Critical issues: 2-4 hours<br>
                • General support: 24 hours<br>
                • Sales inquiries: 4 hours
            </small>
        </div>
    </div>
</div>


<!-- Still have questions CTA -->
<div class="bg-light p-5 rounded text-center mt-5">
    <h4 class="mb-3">Still have questions?</h4>
    <p class="text-muted mb-4">We're here to help you get the most out of SilentCanary.</p>
    {% if current_user.is_authenticated %}
    <a href="{{ url_for('help_overview') }}" class="btn btn-primary">
        <i class="fas fa-book me-2"></i>Browse Documentation
    </a>
    {% else %}
    <a href="{{ url_for('register') }}" class="btn btn-primary">
        <i class="fas fa-rocket me-2"></i>Start Free Trial
    </a>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    // Form submission handling
    document.getElementById('contactForm').addEventListener('submit', function(e) {
        const submitBtn = this.querySelector('button[type="submit"], input[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
    });
    
    // Auto-expand FAQ items from URL hash
    document.addEventListener('DOMContentLoaded', function() {
        if (window.location.hash) {
            const target = document.querySelector(window.location.hash);
            if (target && target.classList.contains('collapse')) {
                const collapse = new bootstrap.Collapse(target, { show: true });
            }
        }
    });

    // Handle CSRF token expiration on form submit
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('contactForm');
        if (form) {
            form.addEventListener('submit', function(e) {
                const csrfToken = form.querySelector('input[name="csrf_token"]');
                if (!csrfToken || !csrfToken.value) {
                    e.preventDefault();
                    alert('Security token missing. Please refresh the page and try again.');
                    return false;
                }
            });
            
            // Optionally refresh CSRF token periodically (every 30 minutes)
            setInterval(async function() {
                try {
                    const response = await fetch('/csrf-token', {
                        method: 'GET',
                        credentials: 'same-origin'
                    });
                    if (response.ok) {
                        const data = await response.json();
                        if (data.csrf_token) {
                            const csrfInput = form.querySelector('input[name="csrf_token"]');
                            if (csrfInput) {
                                csrfInput.value = data.csrf_token;
                            }
                        }
                    }
                } catch (error) {
                    console.warn('Failed to refresh CSRF token:', error);
                }
            }, 30 * 60 * 1000); // 30 minutes
        }
    });
</script>
{% endblock %}